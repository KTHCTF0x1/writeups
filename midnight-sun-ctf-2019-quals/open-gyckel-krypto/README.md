## Title: open-gyckel-krypto
**Points:** 226
**Solves:** 56

### Description: 
Primes are fun, don't google translate me bro

### Solution:
```python
while True:
    p = next_prime(random.randint(0, 10**500))
    if len(str(p)) != 500:
        continue
    q = Integer(int(str(p)[250:] + str(p)[:250]))
    if q.is_prime():
        break

>>> p*q
6146024643941503757217715363256725297474582575057128830681803952150464985329239705861504172069973746764596350359462277397739134788481500502387716062571912861345331755396960400668616401300689786263797654804338789112750913548642482662809784602704174564885963722422299918304645125966515910080631257020529794610856299507980828520629245187681653190311198219403188372517508164871722474627810848320169613689716990022730088459821267951447201867517626158744944551445617408339432658443496118067189012595726036261168251749186085493288311314941584653172141498507582033165337666796171940245572657593635107816849481870784366174740265906662098222589242955869775789843661127411493630943226776741646463845546396213149027737171200372484413863565567390083316799725434855960709541328144058411807356607316377373917707720258565704707770352508576366053160404360862976120784192082599228536166245480722359263166146184992593735550019325337524138545418186493193366973466749752806880403086988489013389009843734224502284325825989
>>> pow(m, 65537, p * q)
3572030904528013180691184031825875018560018830056027446538585108046374607199842488138228426133620939067295245642162497675548656988031367698701161407333098336631469820625758165691216722102954230039803062571915807926805842311530808555825502457067483266045370081698397234434007948071948000301674260889742505705689105049976374758307610890478956315615270346544731420764623411884522772647227485422185741972880247913540403503772495257290866993158120540920089734332219140638231258380844037266185237491107152677366121632644100162619601924591268704611229987050199163281293994502948372872259033482851597923104208041748275169138684724529347356731689014177146308752441720676090362823472528200449780703866597108548404590800249980122989260948630061847682889941399385098680402067366390334436739269305750501804725143228482932118740926602413362231953728010397307348540059759689560081517028515279382023371274623802620886821099991568528927696544505357451279263250695311793770159474896431625763008081110926072287874375257
```
In this challange, the above code is given.
This is a normal RSA encryption, but the primes are generated in a special way.  

Thing to note are:

* $p$ is always 500 digits long
* $q$ is constructed by splitting $p$ in half and then swapping the halfs

This means that the following is true:

* $p = a + b\cdot10^{250}$
* $q = b + a\cdot10^{250}$
* $a$ and $b$ have at most 250 digits

Computing $n$ from this yields the following pattern:

$n = pq = ab + (a^2 + b^2)\cdot10^{250} + ab\cdot10^{500}$

We can note that:

* $ab$, $a^2$ and $b^2$ are at most 500 digits
* $a^2 + b^2$ is at most 501 digits, where the extra digit in the front can only be 1

This means that the last 250 digits of $n$ will be the last 250 digits of $ab$. 

Likewise, all digits before the last 500 digits of $n$ will be the beginning of $ab$, except that $a^2 + b^2$ might have an extra 1 in front of it, which we would have to subtract first (which we do in this case).

$ab = n \% 10^{250} + (\lfloor\frac{n}{10^{500}}\rfloor - \epsilon)\cdot10^{250}, \epsilon \in \{0,1\}$

We can then get $a^2 + b^2$: 

$a^2 + b^2 = \dfrac{n - ab - ab\cdot10^{500}}{10^{250}}$

From this we can get $a$ and $b$:

$a - b = \sqrt{(a-b)^2} = \sqrt{a^2 + b^2 - 2ab}$

$a + b = \sqrt{(a+b)^2} = \sqrt{a^2 + b^2 + 2ab}$

$a = \dfrac{a+b + a-b}{2}$

$b = a+b-b$

After this we can construct $p$ and $q$ and solve the RSA like usual.

$d \equiv e^{-1}\mod (p-1)(q-1)$

$m \equiv c^d\mod n$

The following code solves the challange:

```python
ab = int(int(n[:250]-1) + n[750:])
a2plusb2 = int(n) - ab - ab * 10**500 - 1
aplusb = isqrt(a2plusb2 + 2*ab)
aminusb = isqrt(a2plusb2 - 2*ab)
a = (aplusb + aminusb)//2
b = aplusb - a
p = a + b * 10**250
q = b + a * 10**250
d = modinv(65537, (p-1)*(q-1))
print hex(pow(c, d, n))[2:-1].decode('hex')
```

**Flag:** `midnight{w3ll_wh47_d0_y0u_kn0w_7h15_15_4c7u4lly_7h3_w0rld5_l0n6357_fl46_4nd_y0u_f0und_17_50_y0u_5h0uld_b3_pr0ud_0f_y0ur53lf_50_uhmm_60_pr1n7_7h15_0n_4_75h1r7_0r_50m37h1n6_4nd_4m4z3_7h3_p30pl3_4r0und_y0u}`